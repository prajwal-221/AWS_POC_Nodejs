version: 0.2

env:
  variables:
    DEFAULT_VERSION_TYPE: "minor"

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo "Installing dependencies…"
      - npm install

  pre_build:
    commands:
      - echo "Logging into CodeArtifact…"
      - aws codeartifact login --tool npm --domain ledgerlink-domain --domain-owner 273491477087 --repository ledgerlink --region us-east-1

      - echo "Determining bump type…"
      - export FINAL_VERSION_TYPE=${VERSION_TYPE:-$DEFAULT_VERSION_TYPE}
      - echo "→ FINAL_VERSION_TYPE = $FINAL_VERSION_TYPE"

      - echo "Bumping version…"
      - npm version "$FINAL_VERSION_TYPE" --no-git-tag-version

  build:
    commands:
      - echo "Publishing to CodeArtifact…"
      - npm publish

artifacts:
  files:
    - '**/*'
